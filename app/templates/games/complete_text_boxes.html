{% load i18n %}

<div id="game-{{ id }}">
{#    <ol>#}
{#        <li v-for="(element, index) in terms"#}
{#            :key="element.fields.text"#}
{#        >#}
{#            <% element.fields.text %>#}
{#        </li>#}
{#    </ol>#}
    <div v-for="(item, index) in items" class="card mb-3 ml-0 mr-0">
        <div class="card-body">
            <p class="card-text">
                <% item.fields.text %>
            </p>
        </div>
        <div class="card-footer">
            <select class="custom-select"
                    @input="checkSelected($event, item.pk, item.fields.correct_term)"
                    v-model="options[index]">
                <option selected :value=0>
                    {% trans "Choose..." %}
                </option>
                <option v-for="term in terms"
                        :value="term.pk"
                        :key="term.fields.text"
                >
                    <% term.fields.text %>
                </option>
            </select>
        </div>
    </div>
    <button class="btn btn-primary" @click="check">{% trans "Check answers" %}</button>
    <button class="btn btn-warning" @click="restart">{% trans "Restart" %}</button>
    <hr>
    <div>
        SELECTED: <% selected %>
    </div>
    <hr>
    OPTIONS: <% options %>
</div>

<script>
    let game{{ id }} = new Vue({
        el: '#game-{{ id }}',
        delimiters: ['<%', '%>'],
        data: {
            terms: JSON.parse("{{ terms }}".replace(/&quot;/g, '\"')),
            items: JSON.parse("{{ items }}".replace(/&quot;/g, '\"')),
            selected: {},
            hack: {}
        },
        computed: {
            options: function() {
                terms_size = Object.keys(this.terms).length
                options_values = {}
                for (i = 0; i < terms_size; i++) {
                    options_values[i] = 0
                }
                return options_values
            }
        },
        methods: {
            checkSelected: function (event, item_id, correct_term) {
                selected_id = parseInt(event.target.value)
                correct = (selected_id === correct_term)
                this.$set(this.selected, item_id, correct)
            },
            check: function () {
                console.log('check')

                // check if all items were answered
                items_size = Object.keys(this.selected).length
                terms_size = Object.keys(this.terms).length
                if (items_size < terms_size) {
                   return window.alert(gettext("Please answer all items."))
                }

                // check if all answers are correct
                let items_answers = Object.values(this.selected).every(item => item)

                // return feedback
                if (items_answers) {
                    return window.alert(gettext("You got it! Congratulations."))
                } else {
                    return window.alert(gettext("Please try again."))
                }
            },
            restart: function () {
                Object.keys(this.options).forEach(item => this.$set(this.options, item, 0))
                this.selected = {}
                {#this.$set(this.selected, '5', false)#}
                {#this.$set(this.options, '4', 0)#}
            }
        }
    })
</script>